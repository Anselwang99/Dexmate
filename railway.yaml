services:
    backend:
        build:
            context: ./backend
            dockerfile: Dockerfile
        environment:
            - DATABASE_URL=file:./dev.db
            - JWT_SECRET=${JWT_SECRET}
            - PORT=3001
        healthcheck:
            test:
                [
                    "CMD",
                    "wget",
                    "--quiet",
                    "--tries=1",
                    "--spider",
                    "http://localhost:3001/api/health",
                ]
            interval: 30s
            timeout: 10s
            retries: 3
        restart: unless-stopped

    frontend:
        build:
            context: ./frontend
            dockerfile: Dockerfile
        ports:
            - "80:80"
        depends_on:
            - backend
        environment:
            - VITE_API_URL=https://${RAILWAY_STATIC_URL}
        restart: unless-stopped
